<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <title>OpenCL Option Pricer</title>
  <link rel="stylesheet" href="css/normalize.css">
  <link rel="stylesheet" href="css/style.css">
  <link rel="stylesheet" href="css/bootstrap.css">

  <script src="js/libs/jquery-1.10.2.js"></script>
  <script src="js/libs/handlebars-1.1.2.js"></script>
  <script src="js/libs/ember-1.5.0.js"></script>
  <script src="js/libs/ember-data.js"></script>
  <script src="js/libs/bootstrap.js"></script>

  <script src="js/app.js"></script>
  <script src="js/models/option.js"></script>
  <!-- to activate the test runner, add the "?test" query string parameter -->
  <script src="tests/runner.js"></script>
</head>
<body>
  <script type="text/x-handlebars">
    <div class="container">
      <div class="unit-centered unit-50">
	<div class="row">
	  <div class="page-header">
	    <h1>
	      {{title}}
	      <small>{{tagline}}</small>
	    </h1>
	  </div>
	</div>

	{{outlet}}

      </div>
    </div>
  </script>

  <script type="text/x-handlebars" id="options/new">
    <div class="panel panel-default">
      <div class="panel-heading">New Option</div>
      <div class="panel-body">
	<form class="form-horizontal">
	  <fieldset>
	    <legend>Option Parameters</legend>
	    <div class="form-group">
	      <label for="option-type" class="col-sm-2 control-label">Type</label>
	      <div class="col-sm-4">
		{{view Ember.Select class="form-control" id="option-type" content=option_types optionValuePath="content.code" optionLabelPath="content.name" value=model.type}}
	      </div>
	    </div>
	    <div class="form-group">
	      <label for="strike-price" class="col-sm-2 control-label">Strike Price</label>
	      <div class="col-sm-4">
		<div class="input-group">
		  {{input type="number" id="strike-price" class="form-control" value=model.strike_price}}
		  <span class="input-group-addon">HKD</span>
		</div>
	      </div>
	    </div>
	    <div class="form-group">
	      <label for="maturity" class="col-sm-2 control-label">Maturity</label>
	      <div class="col-sm-4">
		<div class="input-group">
		  {{input type="number" id="maturity" class="form-control" value=model.maturity}} 
		  <span class="input-group-addon">years</span>
		</div>
	      </div>
	    </div>
	    <div class="form-group">
	      <label for="risk-free-rate" class="col-sm-2 control-label">Risk-free rate</label>
	      <div class="col-sm-4">
		<div class="input-group">
		  {{input type="number" id="risk-free-rate" class="form-control" value=model.risk_free_rate}} 
		  <span class="input-group-addon">%</span>
		</div>
	      </div>
	    </div>
	    {{#if is_asian}}
	    <div class="form-group">
	      <label for="averaging-steps" class="col-sm-2 control-label">Averaging steps</label>
	      <div class="col-sm-4">
		{{input type="number" id="averaging-steps" class="form-control" value=model.averaging_steps}} 
	      </div>
	    </div>
	    {{/if}}
	  </fieldset>

	  <fieldset>
	    <legend>Asset Parameters</legend>
	    {{#if is_basket}}
	    <table class="table">
	      <thead>
		<tr>
		  <th class="col-sm-1" />
		  <th class="col-sm-2">Start Price</th>
		  <th class="col-sm-3">Volatility</th>
	      </thead>
	      
	      <tbody>
		{{#each asset in model.assets}}
		<tr>
		  <th>#{{index1 asset.index}}</th>
		  <td>
		    <div class="input-group">
		      {{input type="number" class="form-control" value=asset.start_price}}
		      <span class="input-group-addon">HKD</span>
		    </div>
		  </td>
		  <td>
		    <div class="input-group">
		      {{input type="number" class="form-control" value=asset.volatility}}
		      <span class="input-group-addon">%</span>
		    </div>
		  </td>
		</tr>
		{{/each}}
	      </tbody>
	    </table>
	    {{else}}
	    <div class="form-group">
	      <label for="start-price" class="col-sm-2 control-label">Start Price</label>
	      <div class="col-sm-4">
		<div class="input-group">
		  {{input type="number" id="start-price" class="form-control" value=start_price}}
		  <span class="input-group-addon">HKD</span>
		</div>
	      </div>
	    </div>
	    <div class="form-group">
	      <label for="volatility" class="col-sm-2 control-label">Volatility</label>
	      <div class="col-sm-4">
		<div class="input-group">
		  {{input type="number" id="volatility" class="form-control" value=volatility}}
		  <span class="input-group-addon">%</span>
		</div>
	      </div>
	    </div>
	    {{/if}}

	  <div class="form-group">
	    <div class="col-sm-offset-2 col-sm-4">
	      <button {{action create_option}} type="submit" class="btn btn-default">Create</button>
	    </div>
	  </div>
	</form>
      </div>
    </div>
  </script>

  <script type="text/x-handlebars" id="options/index">
    <div class="row">
      {{#link-to "options.new" class="btn btn-lg btn-default btn-block" type="button"}}New option{{/link-to}}
      <hr>
    </div>

    <div class="row">
      <h3><small>History</small></h3>
      
      <div class="panel-group" id="accordion">
	{{#each option in model itemController="option"}}
	{{log option.assets}}
	<div class="panel panel-default">
	  <div class="panel-heading">
	    <h4 class="panel-title">
	      <a data-toggle="collapse" data-parent="#accordion" {{bind-attr href=option.panel_href}}>
		{{option.type_string}} option <small>{{option.timestamp}}</small>
	      </a>
	    </h4>
	  </div>
	  <div {{bind-attr id=option.panel_id}} class="panel-collapse collapse">
	    <div class="panel-body">

	      <div class="panel panel-default">
		<div class="panel-heading">Option Parameters</div>
		<div class="panel-body">
		  <table class="table">
		    <tr>
		      <th class="col-sm-1">Strike Price</th>
		      <td class="col-sm-2">{{option.strike_price}} {{unit "HKD"}}</td>
		    </tr>
		    <tr>
		      <th>Maturity</th>
		      <td>{{option.maturity}} {{unit "years"}}</td>
		    </tr>
		    <tr>
		      <th>Risk-free rate</th>
		      <td>{{option.risk_free_rate}} %</td>
		    </tr>
		    {{#if option.averaging_steps}}
		    <tr>
		      <th>Averaging steps</th>
		      <td>{{option.averaging_steps}}</td>
		    </tr>
		    {{/if}}
		  </table>
		</div>
	      </div>

	      {{#if option.is_basket}}
	      <div class="panel panel-default">
		<div class="panel-heading">Asset Parameters</div>
		<div class="panel-body">
		  <table class="table">
		    <thead>
		      <tr>
			<th class="col-sm-1" />
			<th class="col-sm-2">Start Price</th>
			<th class="col-sm-3">Volatility</th>
		    </thead>
		    
		    <tbody>
		      {{#each asset in option.assets}}
		      <tr>
			<th>#{{asset.index}}</th>
			<td>{{asset.start_price}} {{unit "HKD"}}</td>
			<td>{{asset.volatility}} %</td>
		      </tr>
		      {{/each}}
		    </tbody>
		  </table>
		</div>
	      </div>

	      <div class="panel panel-default">
		<div class="panel-heading">Asset Correlations</div>
		<div class="panel-body">
		  <table class="table">
		    <thead>
		      <tr>
			<th class="col-sm-1"></th>
			{{#each correlation_row in option.correlations}}
			<th {{bind-attr class=correlation_row.column_class}}>#{{correlation_row.row_index}}</th>
			{{/each}}
		      </tr>
		    </thead>
		    
		    <tbody>
		      {{#each correlation_row in option.correlations}}
		      <tr>
			<th>#{{correlation_row.row_index}}</th>
			{{#each correlation in correlation_row.row}}
			<td {{bind-attr class="correlation.text_muted"}}>{{correlation.value}} %</td>
			{{/each}}
		      </tr>
		      {{/each}}
		    </tbody>
		  </table>
		</div>
	      </div>
	      {{else}}
	      <div class="panel panel-default">
		<div class="panel-heading">Asset Parameters</div>
		<div class="panel-body">
		  <table class="table">
		    <tr>
		      <th class="col-sm-1">Start Price</th>
		      <td class="col-sm-2">{{option.start_price}} {{unit "HKD"}}</td>
		    </tr>
		    <tr>
		      <th>Volatility</th>
		      <td>{{option.volatility}} %</td>
		    </tr>
		  </table>
		</div>
	      </div>
	      {{/if}}

	      <div class="panel panel-default">
		<div class="panel-heading">Pricing Results</div>
		<div class="panel-body">
		  <table class="table">
		    <tr>
		      <th class="col-sm-1">Option Price</th>
		      <td class="col-sm-2">{{option.price}} {{unit "HKD"}}</td>
		    </tr>
		    <tr>
		      <th>Confidence Interval</th>
		      <td>{{option.confidence_interval.[0]}} - {{option.confidence_interval.[1]}} {{unit "HKD"}} ({{interval_size option.confidence_interval}} {{unit "HKD"}})</td>
		    </tr>
		    {{#if option.is_monte_carlo}}
		    <tr>
		      <th>Monte Carlo samples</th>
		      <td>{{option.samples}}</td>
		    </tr>
		    {{/if}}
		  </table>
		</div>
	      </div>
	    </div>
	  </div>
	</div>
	{{/each}}
      </div>      
    </div>    
  </script>
</body>
</html>
